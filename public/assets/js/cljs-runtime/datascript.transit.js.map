{"version":3,"sources":["datascript/transit.cljs"],"mappings":";AAQA,mCAAA,2CAAA,mBAAA,6CAAA,9IAAKA,kFACkBC,+BAEAC,gDACAC;AAGvB,oCAAA,pCAAKC,oFACDC,iBAAS,AAACC,8DAAgB,qBAAA,rBAACC,sCAChB,WAAKC;AAAL,AAAA,kDAAA,sJAAA,5FACY,AAAA,wFAASA,6DACT,AAAA,mFAAOA;IAC9BC,oBAAS,AAACH,8DAAgB,qBAAA,rBAACC,yCAChB,WAAKG;AAAL,AACE,oBAAI,AAACC,0BAAeD;AAApB,0FACG,AAAKA,IAAG,AAAKA,IAAG,AAAKA,IAAG,AAACE,uBAAYF;;AADxC,gIAAA,tCAEG,AAAKA,IAAG,AAAKA,IAAG,AAAKA,IAAG,AAACE,uBAAYF;;IACrDG,sCAAU,KAAAC;AAGd,sCAAA,tCAAMC,oFAAkBC;AAAxB,AACE,OAACC,uBAAO,uDAAA,qDAAA,2CAAA,vJAACC,kNAA2BlB,0CAAiBgB;;AAGvD,uCAAA,vCAAMG,sFAAmBC;AAAzB,AACE,OAACC,wBAAQ,uDAAA,qDAAA,2CAAA,vJAACC,kNAA2BlB,2CAAkBgB","names":["datascript.transit/read-handlers","cljs.core/uuid","datascript.db/db-from-reader","datascript.db/datom-from-reader","datascript.transit/write-handlers","datascript.db/DB","cognitect.transit.write_handler","cljs.core/constantly","db","datascript.db/Datom","d","datascript.db/datom-added","datascript.db/datom-tx","me.tonsky.persistent-sorted-set/BTSet","cognitect.transit/ListHandler","datascript.transit/read-transit-str","s","cognitect.transit/read","cognitect.transit.reader","datascript.transit/write-transit-str","o","cognitect.transit/write","cognitect.transit.writer"],"sourcesContent":["(ns datascript.transit\n  (:require\n    [datascript.core :as d]\n    [datascript.db   :as db]\n    [me.tonsky.persistent-sorted-set :as pss]\n    [cognitect.transit :as t]))\n\n\n(def read-handlers\n  { \"u\"                uuid  ;; favor ClojureScript UUIDs instead of Transit UUIDs\n                             ;; https://github.com/cognitect/transit-cljs/pull/10\n    \"datascript/DB\"    db/db-from-reader\n    \"datascript/Datom\" db/datom-from-reader })\n\n\n(def write-handlers\n  { db/DB    (t/write-handler (constantly \"datascript/DB\")\n               (fn [db]\n                 { :schema (:schema db)\n                   :datoms (:eavt db) }))\n    db/Datom (t/write-handler (constantly \"datascript/Datom\")\n               (fn [d]\n                 (if (db/datom-added d)\n                   [(.-e d) (.-a d) (.-v d) (db/datom-tx d)]\n                   [(.-e d) (.-a d) (.-v d) (db/datom-tx d) false])))\n    pss/BTSet (t/ListHandler.) })\n\n\n(defn read-transit-str [s]\n  (t/read (t/reader :json { :handlers read-handlers }) s))\n\n\n(defn write-transit-str [o]\n  (t/write (t/writer :json { :handlers write-handlers }) o))\n"]}