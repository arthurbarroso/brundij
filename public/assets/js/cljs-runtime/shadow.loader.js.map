{
"version":3,
"file":"shadow.loader.js",
"lineCount":117,
"mappings":"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",
"sources":["shadow/loader.js"],
"sourcesContent":["goog.provide(\"shadow.loader\");\ngoog.require(\"goog.module.ModuleManager\");\ngoog.require(\"goog.module.ModuleLoader\");\ngoog.require(\"goog.object\");\ngoog.require(\"goog.html.uncheckedconversions\");\ngoog.require(\"goog.string.Const\");\n\n/** @define {boolean} */\nshadow.loader.TEST = goog.define(\"shadow.loader.TEST\", false);\n\n// this is written in JS so it doesn't depend on cljs.core\n\nshadow.loader.ml = new goog.module.ModuleLoader();\nshadow.loader.ml.setSourceUrlInjection(true);\n\nshadow.loader.mm = goog.module.ModuleManager.getInstance();\nshadow.loader.mm.setLoader(shadow.loader.ml);\n\nshadow.loader.initCalled = false;\n\nshadow.loader.ensureInitWasCalled = function () {\n  if (!shadow.loader.initCalled) {\n    throw new Error(\n      \"shadow.loader API was called before shadow.loader.init!\\n\" +\n        \"You are probably calling module loader too early before shadow-cljs got fully initialized.\"\n    );\n  }\n};\n\nshadow.loader.init = function (uriPrefix) {\n  if (shadow.loader.TEST) return;\n\n  if (shadow.loader.initCalled) {\n    throw new Error(\n      \"shadow.loader.init was already called! If you are calling it manually set :module-loader-init false in your config.\"\n    );\n  }\n\n  if (goog.global.shadow$modules) {\n    var mm = shadow.loader.mm;\n    mm.setAllModuleInfo(goog.global.shadow$modules[\"infos\"]);\n\n    var uris = goog.global.shadow$modules[\"uris\"];\n\n    // this is absurd. the uris are generated by the compiler. should be trusted already.\n    // I would really like to know how Google integrates this data into their builds\n    var trustReason = goog.string.Const.from(\"generated by compiler\");\n\n    goog.object.getKeys(uris).forEach(function (key) {\n      var module_uris = uris[key];\n      if (module_uris.length == 0) {\n        // default module is added without uris since it will always be loaded\n        // when this is called\n        mm.getModuleInfo(key).setLoaded();\n      } else {\n        var trusted_uris = [];\n        module_uris.forEach(function (module_uri) {\n          var trusted =\n            goog.html.uncheckedconversions.trustedResourceUrlFromStringKnownToSatisfyTypeContract(\n              trustReason,\n              uriPrefix + module_uri\n            );\n          trusted_uris.push(trusted);\n        });\n        mm.getModuleInfo(key).setTrustedUris(trusted_uris);\n      }\n    });\n\n    shadow.loader.initCalled = true;\n  }\n};\n\nshadow.loader.getModuleManager = function () {\n  return shadow.loader.mm;\n};\n\nshadow.loader.getModuleLoader = function () {\n  return shadow.loader.ml;\n};\n\n// allow calling (shadow.loader/load :with-a-keyword)\nshadow.loader.string_id = function (id) {\n  var result = id.toString();\n  if (result.charAt(0) == \":\") {\n    result = result.substring(1);\n  }\n  return result;\n};\n\nshadow.loader.set_load_start = function (id) {\n  shadow.loader.mm.beforeLoadModuleCode(id);\n};\n\n// FIXME: id no longer required, just keeping it in case someone ends up using old closure lib\nshadow.loader.set_loaded = function (id) {\n  shadow.loader.mm.setLoaded(id);\n};\n\n// ignored. only for cljs.loader compat\nshadow.loader.set_loaded_BANG_ = function () {};\n\nshadow.loader.loaded_QMARK_ = function (id) {\n  if (shadow.loader.TEST) {\n    return true;\n  }\n\n  return shadow.loader.mm.getModuleInfo(shadow.loader.string_id(id)).isLoaded();\n};\n\nshadow.loader.with_module = function (\n  moduleId,\n  fn,\n  opt_handler,\n  opt_noLoad,\n  opt_userInitiated,\n  opt_preferSynchronous\n) {\n  shadow.loader.ensureInitWasCalled();\n  return shadow.loader.mm.execOnLoad(\n    shadow.loader.string_id(moduleId),\n    fn,\n    opt_handler,\n    opt_noLoad,\n    opt_userInitiated,\n    opt_preferSynchronous\n  );\n};\n\nshadow.loader.load = function (id, cb) {\n  if (shadow.loader.TEST) {\n    var result = goog.async.Deferred.succeed();\n    if (cb) {\n      result = result.then(cb);\n    }\n    return result;\n  }\n\n  shadow.loader.ensureInitWasCalled();\n  id = shadow.loader.string_id(id);\n  if (cb) {\n    shadow.loader.mm.execOnLoad(id, cb);\n  }\n  return shadow.loader.mm.load(id);\n};\n\nshadow.loader.load_multiple = function (ids, opt_userInitiated) {\n  if (shadow.loader.TEST) {\n    var result = {};\n    for (const id of ids) {\n      result[id] = goog.async.Deferred.succeed();\n    }\n    return result;\n  }\n  shadow.loader.ensureInitWasCalled();\n  return shadow.loader.mm.loadMultiple(ids, opt_userInitiated);\n};\n\nshadow.loader.prefetch = function (id) {\n  if (shadow.loader.TEST) return;\n\n  shadow.loader.ensureInitWasCalled();\n  shadow.loader.mm.prefetchModule(shadow.loader.string_id(id));\n};\n\nshadow.loader.preload = function (id) {\n  if (shadow.loader.TEST) return;\n\n  shadow.loader.ensureInitWasCalled();\n  return shadow.loader.mm.preloadModule(shadow.loader.string_id(id));\n};\n"],
"names":["goog","provide","require","shadow","loader","TEST","define","ml","module","ModuleLoader","setSourceUrlInjection","mm","ModuleManager","getInstance","setLoader","initCalled","ensureInitWasCalled","shadow.loader.ensureInitWasCalled","Error","init","shadow.loader.init","uriPrefix","global","shadow$modules","setAllModuleInfo","uris","trustReason","string","Const","from","object","getKeys","forEach","key","module_uris","length","getModuleInfo","setLoaded","trusted_uris","module_uri","trusted","html","uncheckedconversions","trustedResourceUrlFromStringKnownToSatisfyTypeContract","push","setTrustedUris","getModuleManager","shadow.loader.getModuleManager","getModuleLoader","shadow.loader.getModuleLoader","string_id","shadow.loader.string_id","id","result","toString","charAt","substring","set_load_start","shadow.loader.set_load_start","beforeLoadModuleCode","set_loaded","shadow.loader.set_loaded","set_loaded_BANG_","shadow.loader.set_loaded_BANG_","loaded_QMARK_","shadow.loader.loaded_QMARK_","isLoaded","with_module","shadow.loader.with_module","moduleId","fn","opt_handler","opt_noLoad","opt_userInitiated","opt_preferSynchronous","execOnLoad","load","shadow.loader.load","cb","async","Deferred","succeed","then","load_multiple","shadow.loader.load_multiple","ids","loadMultiple","prefetch","shadow.loader.prefetch","prefetchModule","preload","shadow.loader.preload","preloadModule"]
}
